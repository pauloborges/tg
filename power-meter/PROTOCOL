MÁQUINA DE ESTADOS
==================

STOPPED <--> MONITOR
   ^
   |
   v
SNAPSHOT


PROTOCOLO
=========

O protocolo é formado por três tipos de mensagens:

* Requests:  mensagens enviadas pelo host.
* Responses: mensagens enviadas pelo Arduino em resposta a uma request.
* Events:    mensagens enviadas pelo Arduino para avisar o host de um evento.

As mensagens são puramente textuais (para facilitar a depuração via terminal) e cada mensagem utiliza '\n' como indicativo do fim da mesma.

O formato de uma mensagem é:

[ OPCODE | PAYLOAD | '\n' ]
  1 byte   n bytes     1

O OPCODE deve ser a representação ASCII de uma letra maiúscula: 'A' <= OPCODE <= 'Z'.

O PAYLOAD é variável e seu formato depende do OPCODE.

OPCODES
-------

* 'S' STOP
* 'P' SNAPSHOT
* 'M' MONITOR
* 'O' OK
* 'N' NO
* 'I' EVENTO INSTANTÂNEO
* 'A' EVENTO AGREGADO

REQUESTS
========

STOP
----

Leva o Arduino ao estado STOPPED, interrompendo qualquer possível atividade que o mesmo
esteja realizando no momento.

MENSAGEM

[ 'S' | '\n' ]


SNAPSHOT
--------

Roda a rotina principal do firmware por uma quantidade específica de vezes.

MENSAGEM

[ 'P' | F | M | NUMWAVES | NUMSAMPLES | '\n' ]
        1   1   3  bytes    3  bytes

F: usar amostras fictícias
    '0': utilizar amostras reais
    '1': utilizar amostras fictícias

M: modo de operação
    'I': modo instantâneo
        Gera eventos com a tensão e corrente instantâneas
    'A': modo agregado
        Gera eventos com a tensão RMS, corrente RMS e potência real

NUMWAVES:   * quantidade de ondas para computar o modo agregado (no modo
              instantâneo esse valor é ignorado)
            * 3 bytes ("001" até "999")
            * Valor "000" é inválido (o firmware deve responder "NO")

NUMSAMPLES: * quantidade de ciclos (quantas vezes irá iterar
              sobre o número de waves)
            * 3 bytes ("001" até "999")
            * Valor "000" é inválido (o firmware deve responder "NO")


MONITOR
-------

Roda a rotina principal do firmware por tempo indeterminado (até o firmware receber um STOP request).

[ 'M' | F | M | NUMWAVES | '\n' ]
        1   1   3  bytes

F, M e NUMWAVES: mesma semântica descrita em SNAPSHOT.

RESPONSES
=========

OK
--

Enviado pelo firmware para indicar que o último request recebido é/será processado.

MENSAGEM 

[ 'O' | 'K' | '\n' ]


NO
--

Enviado pelo firmware para indicar que o último request recebido não será processado.

MENSAGEM

[ 'N' | 'O' | '\n' ]


EVENTS
======

MODO INSTANTÂNEO
----------------

'I'
[T]
[V]
[I]

MODO AGREGADO
-------------

'A'
[T]
[V_RMS]
[I_RMS]
[RP]
